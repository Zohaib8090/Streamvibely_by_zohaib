name: Encode Keystore to Text

on:
  workflow_dispatch: # Allows manual triggering

jobs:
  encode:
    runs-on: ubuntu-latest
    steps:
      - name: Download Keystore Artifact
        uses: actions/download-artifact@v4
        with:
          name: keystore-artifact
          # This is a bit of a trick. We need to find the latest run of the *other* workflow.
          # We will assume the latest successful run of this repo is the one we want.
          github-token: ${{ secrets.GITHUB_TOKEN }}
          run-id: ${{ github.event.workflow_run.id }}
          
      - name: Debug downloaded files
        run: ls -R

      - name: Encode Keystore to Base64
        run: base64 release.keystore > keystore_b64.txt

      - name: Upload Base64 Text as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: keystore-b64-text
          path: keystore_b64.txt
